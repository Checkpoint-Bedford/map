<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>CHECKPOINT | The Map</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --primary: #1e3a8a;
  --banner-h: 95px;
  --header-h: 55px;
  --panel-w: 300px;
}
html,body{height:100%; margin:0; font-family:'Poppins',sans-serif; background:#fff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; -webkit-text-size-adjust:100%;}
.blue-banner{position: fixed; top:0; left:0; right:0; height: var(--banner-h); background: var(--primary); z-index: 9996;}
header{position: fixed; top: 6px; left: 18px; height: var(--header-h); display:flex; align-items:center; color: #fff; font-weight:700; font-size:20px; z-index: 9997;}
header .byline{ font-weight:400; margin-left:10px; color:#d1d5db; font-size:13px; }
  
.credit{
    position: fixed;
    bottom: 6px;
    right: 9px;
    font-size:14px;
    color:gray;
    opacity:0.7;
    z-index:500;
}

#map{position:absolute; top: var(--banner-h); left:0; right:0; bottom:0; z-index:0;}

.controls-row{position: fixed; top: calc(var(--header-h) + 10px); left:0; right:0; height: calc(var(--banner-h) - var(--header-h) - 10px); z-index: 9998; pointer-events: none;}
.controls-inner{max-width:1200px; margin:0 20px; height:100%; display:flex; align-items:center; justify-content:space-between; pointer-events:auto;}
.search-box{ width:220px; position:relative;}
.search-input{width:100%; padding:9px 12px; border-radius:999px; border:2px solid var(--primary); box-shadow:0 6px 14px rgba(0,0,0,0.12); font-size:16px; background:#fff; box-sizing:border-box;}
.search-suggestions{display:none; position:absolute; top: calc(100% + 8px); left:0; width:100%; background:#fff; border-radius:12px; border:2px solid var(--primary); box-shadow:0 6px 18px rgba(0,0,0,0.12); max-height:260px; overflow-y:auto; z-index:100000;}
.suggestion{display:flex; gap:10px; align-items:center; padding:10px 12px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; background:#fff;}
.suggestion:last-child{border-bottom:none;}
.suggestion:hover{background:#eef2ff;}
.dot{width:14px; height:14px; border-radius:50%; border:2px solid #000; flex:0 0 auto; display:inline-block; vertical-align:middle;}
.label{line-height:1.05;}
.match{ font-weight:700; background: linear-gradient(transparent 60%, rgba(255,230,230,0.6) 60%);}

.phone-btn{background: var(--primary); color:white; border:2px solid black; padding:12px 16px; border-radius:28px; cursor:pointer; font-size:15px; font-weight:600; white-space:nowrap;}
.phone-panel{position:fixed; top:0; right:0; width:var(--panel-w); height:100vh; background:#fff2f2; border-left:3px solid black; padding:18px; box-shadow:-3px 0 8px rgba(0,0,0,0.25); transform:translateX(100%); transition:transform 0.32s ease; z-index:100001; overflow-y:auto; box-sizing:border-box;}
.phone-panel.open{transform:translateX(0);}
.panel-close{float:right; cursor:pointer; font-size:18px;}

.legend{position:fixed; left:20px; bottom:12px; background:#fff; padding:8px 12px; border-radius:8px; border:2px solid #000; box-shadow:0 3px 8px rgba(0,0,0,0.2); z-index:99999; font-size:12px; line-height:1.25;}

@media (max-width: 800px){.controls-inner{margin:0 12px;}.search-box{width:170px;}.phone-btn{padding:10px 12px; font-size:14px;}}
@media (max-width: 480px){.search-box{width:150px;}.legend{left:10px; bottom:10px; padding:6px 10px;}}
@media (min-width: 1200px){.search-box{width:300px;}.search-input{font-size:18px; padding:12px 16px;}.phone-btn{font-size:16px; padding:14px 20px;} :root{--panel-w:400px;}}
</style>
</head>
<body>

<div class="blue-banner" aria-hidden="true"></div>

<header>Bedford Support Map <span class="byline">by CHECKPOINT</span></header>

<div class="controls-row" aria-hidden="false">
  <div class="controls-inner">
    <div class="search-box">
      <input id="searchInput" class="search-input" placeholder="Search locations..." autocomplete="off" />
      <div id="suggestions" class="search-suggestions" role="listbox" aria-label="Search suggestions"></div>
    </div>
    <button class="phone-btn" id="phoneBtn" aria-controls="phonePanel" aria-expanded="false">üìû Phone Numbers</button>
  </div>
</div>

<div class="credit">Made by Aaima Shabir</div>

<div id="map"></div>

<div class="legend" id="legend">
  <b>Index</b><br><br>
  <i style="color:#d62828;">‚óè</i> Help Centres<br>
  <i style="color:#1d4ed8;">‚óè</i> Mental Health & Wellbeing<br>
  <i style="color:#138a36;">‚óè</i> Education & Youth<br>
  <i style="color:#7e22ce;">‚óè</i> Diverse Centres<br>
  <i style="color:#0e7490;">‚óè</i> Outdoor spaces<br>
  <i style="color:#f97316;">‚óè</i> Local Services<br>
</div>

<div id="phonePanel" class="phone-panel" aria-hidden="true">
  <span class="panel-close" id="panelClose" role="button" aria-label="Close panel">‚úñ</span>
  <h3>Useful Phone Numbers</h3>
  <ul>
    <li>Citizens Advice Bedford: <b>01234 867944</b></li>
    <li>Bedford Foodbank: <b>01234 268569</b></li>
    <li>Job centre plus: <b>0845 604 3719</b></li>
    <li>BRASS Bedford: <b>01234 211381</b></li>
    <li>SMART First Point Bedford: <b>01234 365955</b></li>
    <li>King's Arm Project: <b>01234 350900</b></li>
    <li>Living Well Centre Bedford: <b>0800 0356 497</b></li>
    <li>CAMHS Bedford: <b>01234 893300</b></li>
    <li>Recovery Lounge Bedford: <b>01234 343869</b></li>
    <li>YMCA Bedfordshire: <b>01234 307040</b></li>
    <li>Bedford Central Library: <b>01234 718178</b></li>
    <li>Kempston Library: <b>01234 276453</b></li>
    <li>Wootton Library: <b>01234 766061</b></li>
    <li>Bedford Creative Arts Centre: <b>01234 818670</b></li>
    <li>Higgins Museum Bedford: <b>01234 718618</b></li>
    <li>De Parys Medical Group: <b>01234 351341</b></li>
    <li>Priory Health Clinic: <b>01234 262040</b></li>
    <li>iCaSH Bedfordshire: <b>0300 300 3030</b></li>
    <li>Beds Fire & Rescue Group: <b>01234 845000</b></li>
    <li>Bedford Talking therapy: <b>01234 880400</b></li>
    <li>FACES Bedford: <b>01234 270 601</b>
    <li>Path to Recovery: <b>0333 332 4019</b></li>
    <li>Putnoe Medical Centre: <b>01234 319992</b></li>
    <li>Bedford Borough Social Services: <b>01234 267422</b></li>
    <li>Wootton Vale Healthy living centre: <b>01234 762500</b>
    <li>Bedford Hospital: <b>01234 355122</b></li>
    <br>
    <li> Thanks for checking out our map! We hope this helps you find the support and guidance you need.</li>
    <br>
    <li>Designer & Developer: Aaima Shabir</li>
    <li>Editor: Aimua Stephen</li>
    <br>
  </ul>
</div>

<script>
const pastel = {
  "Help Centre": "#d62828",
  "Wellbeing": "#1d4ed8",
  "Education": "#138a36",
  "Diverse": "#7e22ce",
  "Outdoor Wellbeing": "#0e7490",
  "Local Service": "#f97316"
};

function getIconSize(){
  if(window.innerWidth >= 1200) return 50;
  if(window.innerWidth >= 800) return 40;
  return 30;
}

function cartoonIcon(color){
  const size = getIconSize();
  return L.divIcon({
    html:`<svg width="${size}" height="${size}" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="${color}" stroke="black" stroke-width="4"/></svg>`,
    className:"",
    iconSize:[size,size],
    iconAnchor:[size/2,size/2]
  });
}

const map = L.map('map',{maxZoom:17}).setView([52.135,-0.47],12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap'}).addTo(map);

const locations=[
["Citizens Advice Bedford","MK40 1TP","Help Centre","Provides advice and guidance across a wide range of issues"],
["Bedford Foodbank","MK41 7PE","Help Centre","Provides emergency food support to those in financial crisis"],
["BRASS Bedford","MK40 2RB","Help Centre","Supports refugees through immigration advice and English tuition"],
["Living Well Centre Bedford","MK40 2DD","Help Centre","Offers support to those enduring a life-limiting condition"],
["Kings Arm Project","MK42 9AZ","Help Centre","Provides support to the homeless and isolated through acommodation and employment assistance"],
["SMART First Point Bedford","MK40 3HZ","Help Centre","Supports the homeless, rough sleeping or those at risk of losing their house"],
["Job Centre Plus","MK40 2EH","Help Centre","Agency that helps individuals find employment"],
["Bedford Hospital","MK42 9DJ","Help Centre","Instituition providing medical and surgical treatment, aswell as dealing with mental health crises"],
["iCaSH Bedford","MK42 0AH","Local Service","Sexual and reproductive health centre offering STI testing & treatment and contraception"],
["CAMHS","MK42 9DJ","Wellbeing","Supports youth experiencing mental health or emotional difficulties"],
["Recovery Lounge Bedford","MK40 2NX","Wellbeing","A safe space for adults experiencing mental health crisis"],
["Bedford Talking Therapies","MK40 2AW","Wellbeing","Offers free confidential talking therapists to help with mental health"],
["FACES Bedford","MK41 0PW","Wellbeing","Offers emotional and practical support to families under stress"],
["Path to Recovery","MK40 2RT","Wellbeing","Service providing support and guidance for those affected by addictions and drug abuse."],
["Bedford Central Library","MK40 1PG","Education","Offers free Wi-fi and access to computers and printing"],
["Kempston Library","MK42 8AT","Education","Offers free Wi-fi and access to computers and printing"],
["Wootton Library","MK43 9LH","Education","Offers free Wi-fi and access to computers and printing"],
["YMCA Bedfordshire","MK40 2AA","Education","Extensive support accomodation and personal training"],
["Bedford Creative Arts","MK41 7PH","Diverse","Arts charity producing socially engaged art products across Bedford"],
["Higgins Museum Bedford","MK40 3XD","Diverse","Cultural service exhibiting social history, archeology and other arts"],
["Russell Park","MK40 3SA","Outdoor Wellbeing","Green space featuring gardens, sports facilities and a cafe"],
["Priory Country Park","MK41 9DJ","Outdoor Wellbeing","Green space including lakes, meadows and woodlands"],
["Addison Howard Park","MK42 8PN","Outdoor Wellbeing","Green space including sports courts and a community garden"],
["De Parys Medical Group","MK40 2TX","Local Service","Health clinic offering immunizations, asthma clinics and more"],
["Priory Health Clinic","MK41 6GA","Local Service","Provider of mental health and adult social care (including depression, anxiety and addictions)"],
["Queen‚Äôs Park Surgery","MK40 4HR","Local Service","GP Practice offering various health services"],
["London Road Surgery","MK42 0NT","Local Service","GP Practice offering various health service"],
["Beds Fire & Rescue Community","MK41 9LN","Local Service","Focuses on community safety and managing road and fire safety"],
["Putnoe Medical Centre","MK41 9JE","Local Service","GP Practice offering various health service"],
["Bedford Borough Social Services","MK42 9AP","Local Service","Ensures children's upbringings are stable, and ensures wellbeing"],
["Wootton Vale Healthy living centre","MK43 9JJ","Local Service","GP Practice offering various health services"]
];

const markerRefs=[];

fetch("https://api.postcodes.io/postcodes",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({postcodes:locations.map(l=>l[1])})
})
.then(r=>r.json())
.then(data=>{
  data.result.forEach((res,i)=>{
    if(!res.result) return;
    const [name, postcode, category, description] = locations[i];
    const lat = res.result.latitude;
    const lon = res.result.longitude;
    const marker = L.marker([lat,lon],{icon:cartoonIcon(pastel[category]||"#999")})
      .bindPopup(`<b>${name}</b><br>${postcode}<br><i style="color:#555">${description}</i>`)
      .addTo(map);
    markerRefs.push({name, postcode, category, description, lat, lon, marker});
  });
});

const input = document.getElementById('searchInput');
const suggestionsEl = document.getElementById('suggestions');

function escapeRegex(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }

input.addEventListener('input', () => {
  const q = input.value.trim().toLowerCase();
  if (!q) { suggestionsEl.style.display='none'; suggestionsEl.innerHTML=''; return; }
  const matches = markerRefs.filter(m => m.name.toLowerCase().includes(q)).slice(0, 10);
  if(matches.length===0){suggestionsEl.style.display='none'; suggestionsEl.innerHTML=''; return;}
  const html = matches.map((m,idx)=>{
    const re=new RegExp('('+escapeRegex(q)+')','ig');
    const highlighted = m.name.replace(re,'<span class="match">$1</span>');
    const color = pastel[m.category] || '#888';
    return `<div class="suggestion" role="option" data-idx="${idx}" data-lat="${m.lat}" data-lon="${m.lon}">
              <div class="dot" style="background:${color}"></div>
              <div class="label">${highlighted}<div style="font-size:12px;color:#666">${m.postcode}</div></div>
            </div>`;
  }).join('');
  suggestionsEl.innerHTML = html;
  suggestionsEl.style.display='block';
  suggestionsEl.querySelectorAll('.suggestion').forEach(el=>{
    el.onclick = ()=>{
      const lat=parseFloat(el.dataset.lat);
      const lon=parseFloat(el.dataset.lon);
      const idx=parseInt(el.dataset.idx,10);
      const picked=markerRefs.filter(m=>m.name.toLowerCase().includes(input.value.trim().toLowerCase()))[idx];
      map.setView([lat,lon],15);
      if(picked && picked.marker) picked.marker.openPopup();
      suggestionsEl.style.display='none';
      input.value=picked?picked.name:'';
    }
  });
});
document.addEventListener('click',(e)=>{
  const box=document.querySelector('.search-box');
  if(!box.contains(e.target)) suggestionsEl.style.display='none';
});

// Phone panel 
const phoneBtn = document.getElementById('phoneBtn');
const phonePanel = document.getElementById('phonePanel');
const panelClose = document.getElementById('panelClose');
function openPhonePanel(){ phonePanel.classList.add('open'); phonePanel.setAttribute('aria-hidden','false'); phoneBtn.setAttribute('aria-expanded','true'); suggestionsEl.style.display='none'; }
function closePhonePanel(){ phonePanel.classList.remove('open'); phonePanel.setAttribute('aria-hidden','true'); phoneBtn.setAttribute('aria-expanded','false'); }
phoneBtn.addEventListener('click',()=>{ if(phonePanel.classList.contains('open')) closePhonePanel(); else openPhonePanel(); });
panelClose.addEventListener('click',closePhonePanel);

  // preventing glitching on mobile

document.addEventListener("gesturestart",e=>e.preventDefault());
document.addEventListener("gesturechange",e=>e.preventDefault());
document.addEventListener("gestureend",e=>e.preventDefault());

</script>
</body>
</html>
