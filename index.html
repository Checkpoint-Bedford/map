<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>CHECKPOINT | Bedford Support Map</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { margin: 0; font-family: Arial, sans-serif; }

        header {
            background: #1e3a8a;
            color: white;
            padding: 15px 25px;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        #map { height: calc(100vh - 70px); width: 100%; }

        .legend {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px 18px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.25);
            z-index: 9999;
            font-size: 16px;
        }

        .phone-btn {
            position: fixed;
            top: 90px;
            right: 20px;
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            z-index: 10000;
            box-shadow: 0 3px 6px rgba(0,0,0,0.25);
        }

        .phone-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 300px;
            height: 100vh;
            background: #ffffff;
            box-shadow: -3px 0 8px rgba(0,0,0,0.3);
            padding: 25px;
            transition: right 0.35s ease;
            z-index: 10001;
            font-size: 18px;
        }

        .phone-panel.open { right: 0; }
        .panel-close { float: right; cursor: pointer; font-size: 22px; }

        @media (max-width: 600px) {
            .legend { font-size: 18px; }
            .phone-btn { font-size: 20px; }
            .phone-panel { width: 85%; font-size: 20px; }
        }
    </style>
</head>

<body>

<header>Bedford Support Map <span class="brand-tag">by CHECKPOINT</span></header>

<div id="map"></div>

<div class="legend">
    <b>Legend</b><br><br>
    <i style='color:red;'>‚óè</i> Help Centres<br>
    <i style='color:blue;'>‚óè</i> Wellbeing<br>
    <i style='color:green;'>‚óè</i> Education<br>
    <i style='color:purple;'>‚óè</i> Diverse<br>
    <i style='color:cadetblue;'>‚óè</i> Outdoor<br>
    <i style='color:orange;'>‚óè</i> Local Services<br>
</div>

<button class="phone-btn" onclick="togglePhonePanel()">üìû Phone Numbers</button>

<div id="phonePanel" class="phone-panel">
    <span class="panel-close" onclick="togglePhonePanel()">‚úñ</span>
    <h3>Useful Phone Numbers</h3>
    <ul>
        <li>Citizens Advice ‚Äî <b>00000 000000</b></li>
        <li>Bedford Foodbank ‚Äî <b>00000 000000</b></li>
        <li>Mental Health Support ‚Äî <b>00000 000000</b></li>
        <li>Emergency Services ‚Äî <b>999</b></li>
    </ul>
</div>

<script>
function togglePhonePanel() {
    document.getElementById("phonePanel").classList.toggle("open");
}

/* --------- BIGGER CUSTOM MARKERS ---------- */

function bigMarker(color) {
    // SVG pin with large size
    return L.divIcon({
        className: "",
        html: `
            <svg width="34" height="34" viewBox="0 0 24 24" fill="${color}" stroke="black" stroke-width="1.2">
                <circle cx="12" cy="12" r="10"></circle>
            </svg>
        `,
        iconSize: [34, 34],
        iconAnchor: [17, 17]
    });
}

/* --------- MAP WITH ZOOM LOCK --------- */
const map = L.map('map', {
    minZoom: 11,
    maxZoom: 14,   // üö´ no zooming beyond this level
    zoomControl: true
}).setView([52.135, -0.47], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

/* --------- LOCATION DATA --------- */
const locations = [
    ["Citizens Advice Bedford", "MK40 1TP", "Help Centre"],
    ["Bedford Foodbank", "MK41 7PE", "Help Centre"],
    ["BRASS Bedford", "MK40 2RB", "Help Centre"],
    ["Kings Arm Project", "MK42 9AZ", "Help Centre"],
    ["SMART First Point Bedford", "MK40 3HZ", "Help Centre"],
    ["Beds Domestic & Sexual Abuse Partnership", "SG1 5TQ", "Help Centre"],
    ["Job Centre Plus", "MK40 2EH", "Help Centre"],

    ["CAMHS", "MK42 9DJ", "Wellbeing"],
    ["Queen‚Äôs Park Family Hub", "MK40 4LE", "Wellbeing"],
    ["Recovery Lounge Bedford", "MK40 2NX", "Wellbeing"],

    ["Bedford Central Library", "MK40 1PG", "Education"],
    ["Kempston Library", "MK42 8AT", "Education"],
    ["Wootton Library", "MK43 9LH", "Education"],
    ["YMCA Bedfordshire", "MK40 2AA", "Education"],

    ["Bedford Creative Arts", "MK41 7PH", "Diverse"],
    ["Higgins Museum Bedford", "MK40 3XD", "Diverse"],

    ["Russell Park", "MK40 3SA", "Outdoor"],
    ["Priory Country Park", "MK41 9DJ", "Outdoor"],
    ["Flitwick Leisure Centre", "MK45 1TH", "Outdoor"],
    ["Sandy Sports Centre", "SG19 1BL", "Outdoor"],
    ["Addison Howard Park", "MK42 8PN", "Outdoor"],

    ["De Parys Medical Group", "MK40 2TX", "Local Service"],
    ["Priory Health Clinic", "MK41 6GA", "Local Service"],
    ["Queen‚Äôs Park Surgery", "MK40 4HR", "Local Service"],
    ["London Road Surgery", "MK42 0NT", "Local Service"],
    ["Beds Fire & Rescue Community", "MK41 9LN", "Local Service"]
];

const colors = {
    "Help Centre": "red",
    "Wellbeing": "blue",
    "Education": "green",
    "Diverse": "purple",
    "Outdoor": "cadetblue",
    "Local Service": "orange"
};

/* --------- GEOCODING --------- */
const postcodes = locations.map(l => l[1]);

fetch("https://api.postcodes.io/postcodes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ postcodes })
})
.then(r => r.json())
.then(data => {
    data.result.forEach((entry, i) => {
        if (!entry.result) return;

        const name = locations[i][0];
        const postcode = locations[i][1];
        const category = locations[i][2];
        const lat = entry.result.latitude;
        const lon = entry.result.longitude;

        L.marker([lat, lon], {
            icon: bigMarker(colors[category])
        })
        .bindPopup(`<b>${name}</b><br>${postcode}`)
        .addTo(map);
    });
});
</script>

</body>
</html>

