<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>CHECKPOINT | Bedford Support Map</title>

<!-- Fixes zoom behaviour without breaking layout -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }

    header {
        background: #1e3a8a;
        color: white;
        padding: 15px 25px;
        font-size: 20px;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    #map {
        height: calc(100vh - 70px);
        width: 100%;
    }

    /* Legend */
    .legend {
        position: fixed;
        bottom: 40px;
        left: 20px;
        background: #ffffff;
        border-radius: 10px;
        padding: 12px 14px;
        box-shadow: 0 3px 8px rgba(0,0,0,0.25);
        border: 2px solid black; /* thin black cartoon line */
        z-index: 9999;
        font-size: 13px;
    }

    /* Phone Button */
    .phone-btn {
        position: fixed;
        top: 90px;
        right: 20px;
        background: #1e3a8a;
        color: white;
        border: 2px solid black; /* cartoon outline */
        padding: 12px 16px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 15px;
        box-shadow: 0 3px 6px rgba(0,0,0,0.25);
        z-index: 999999 !important;
    }

    /* Phone Panel */
    .phone-panel {
        position: fixed;
        top: 0;
        right: -320px; /* Hidden off-screen */
        width: 280px;
        height: 100vh;
        background: #fff7f7; /* light pastel pink */
        border-left: 3px solid black; /* thin cartoon edge */
        box-shadow: -3px 0 8px rgba(0,0,0,0.3);
        padding: 20px;
        transition: right 0.35s ease;
        z-index: 999999 !important;
    }

    .phone-panel.open {
        right: 0; /* slide in */
    }

    .panel-close {
        float: right;
        cursor: pointer;
        font-size: 18px;
        margin-top: -5px;
    }

    .brand-tag {
        font-size: 12px;
        color: #d1d5db;
        margin-left: 10px;
        font-weight: normal;
    }
</style>
</head>

<body>

<header>
    Bedford Support Map <span class="brand-tag">by CHECKPOINT</span>
</header>

<div id="map"></div>

<div class="legend">
    <b>Legend</b><br><br>
    <i style="color:#ff9b9b;">‚óè</i> Help Centres<br>
    <i style="color:#9bb8ff;">‚óè</i> Mental Health & Wellbeing<br>
    <i style="color:#9bffb0;">‚óè</i> Education & Youth<br>
    <i style="color:#d7a4ff;">‚óè</i> Diverse Centres<br>
    <i style="color:#a7e5e8;">‚óè</i> Outdoor Wellbeing<br>
    <i style="color:#ffd59b;">‚óè</i> Local Services<br>
</div>

<!-- Button -->
<button class="phone-btn" onclick="togglePhonePanel()">üìû Phone Numbers</button>

<!-- Panel -->
<div id="phonePanel" class="phone-panel">
    <span class="panel-close" onclick="togglePhonePanel()">‚úñ</span>
    <h3>Useful Phone Numbers</h3>
    <ul>
        <li>Citizens Advice ‚Äî <b>00000 000000</b></li>
        <li>Bedford Foodbank ‚Äî <b>00000 000000</b></li>
        <li>Mental Health Support ‚Äî <b>00000 000000</b></li>
        <li>Emergency Services ‚Äî <b>999</b></li>
    </ul>
</div>

<script>
// Toggle panel (THIS NOW WORKS)
function togglePhonePanel() {
    document.getElementById("phonePanel").classList.toggle("open");
}

// Disable pinch zoom-in
document.addEventListener("gesturestart", e => e.preventDefault());
document.addEventListener("gesturechange", e => e.preventDefault());
document.addEventListener("gestureend", e => e.preventDefault());

// Pastel category colours
const pastel = {
    "Help Centre": "#ff9b9b",
    "Wellbeing": "#9bb8ff",
    "Education": "#9bffb0",
    "Diverse": "#d7a4ff",
    "Outdoor Wellbeing": "#a7e5e8",
    "Local Service": "#ffd59b"
};

// Cartoon icons (slightly smaller)
function cartoonIcon(color) {
    return L.divIcon({
        html: `
            <svg width="28" height="28" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="40"
                    fill="${color}"
                    stroke="black"
                    stroke-width="3"/>
            </svg>
        `,
        className: "",
        iconSize: [28, 28],
        iconAnchor: [14, 14]
    });
}

// Map
const map = L.map("map", { maxZoom: 16 })
.setView([52.135, -0.47], 12);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: '&copy; OpenStreetMap'
}).addTo(map);

// Data
const locations = [
    ["Citizens Advice Bedford", "MK40 1TP", "Help Centre"],
    ["Bedford Foodbank", "MK41 7PE", "Help Centre"],
    ["BRASS Bedford", "MK40 2RB", "Help Centre"],
    ["Kings Arm Project", "MK42 9AZ", "Help Centre"],
    ["SMART First Point Bedford", "MK40 3HZ", "Help Centre"],
    ["Beds Domestic & Sexual Abuse Partnership", "SG1 5TQ", "Help Centre"],
    ["Job Centre Plus", "MK40 2EH", "Help Centre"],

    ["CAMHS", "MK42 9DJ", "Wellbeing"],
    ["Queen‚Äôs Park Family Hub", "MK40 4LE", "Wellbeing"],
    ["Recovery Lounge Bedford", "MK40 2NX", "Wellbeing"],

    ["Bedford Central Library", "MK40 1PG", "Education"],
    ["Kempston Library", "MK42 8AT", "Education"],
    ["Wootton Library", "MK43 9LH", "Education"],
    ["YMCA Bedfordshire", "MK40 2AA", "Education"],

    ["Bedford Creative Arts", "MK41 7PH", "Diverse"],
    ["Higgins Museum Bedford", "MK40 3XD", "Diverse"],

    ["Russell Park", "MK40 3SA", "Outdoor Wellbeing"],
    ["Priory Country Park", "MK41 9DJ", "Outdoor Wellbeing"],
    ["Flitwick Leisure Centre", "MK45 1TH", "Outdoor Wellbeing"],
    ["Sandy Sports Centre", "SG19 1BL", "Outdoor Wellbeing"],
    ["Addison Howard Park", "MK42 8PN", "Outdoor Wellbeing"],

    ["De Parys Medical Group", "MK40 2TX", "Local Service"],
    ["Priory Health Clinic", "MK41 6GA", "Local Service"],
    ["Queen‚Äôs Park Surgery", "MK40 4HR", "Local Service"],
    ["London Road Surgery", "MK42 0NT", "Local Service"],
    ["Beds Fire & Rescue Community", "MK41 9LN", "Local Service"]
];

// Geocode
fetch("https://api.postcodes.io/postcodes", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ postcodes: locations.map(l => l[1]) })
})
.then(r => r.json())
.then(data => {
    data.result.forEach((entry, i) => {
        if (!entry.result) return;

        const [name, postcode, category] = locations[i];
        const lat = entry.result.latitude;
        const lon = entry.result.longitude;

        L.marker([lat, lon], { icon: cartoonIcon(pastel[category]) })
          .bindPopup(`<b>${name}</b><br>${postcode}`)
          .addTo(map);
    });
});
</script>

</body>
</html>

