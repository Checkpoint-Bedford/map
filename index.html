<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CHECKPOINT | Bedford Support Map</title>

<!-- Poppins font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root {
    --primary: #1e3a8a;
    --banner-h: 95px;   /* thinner blue panel */
    --header-h: 55px;   /* brings title higher */
    --panel-w: 300px;
  }

  html, body { height: 100%; margin: 0; font-family: 'Poppins', sans-serif; background:#fff; }

  .blue-banner {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: var(--banner-h);
    background: var(--primary);
    z-index: 99996;
  }

  header {
    position: fixed;
    top: 5px;  /* moves title higher */
    left: 0; right: 0;
    height: var(--header-h);
    padding-left: 18px;
    display: flex;
    align-items: center;
    font-size: 21px;
    font-weight: 700;
    color: white;
    z-index: 99997;
  }

  header .byline {
    font-weight: 400;
    margin-left: 10px;
    color: #d1d5db;
    font-size: 13px;
  }

  #map {
    position: absolute;
    top: var(--banner-h);
    left: 0; right: 0; bottom: 0;
  }

  .controls-row {
    position: fixed;
    top: var(--header-h);
    left: 0; right: 0;
    height: calc(var(--banner-h) - var(--header-h));
    z-index: 99998;
    pointer-events: none;
  }

  .controls-inner {
    height: 100%;
    margin: 0 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    pointer-events: auto;
  }

  .search-box { width: 220px; position: relative; }

  .search-input {
    width: 100%;
    padding: 9px 12px;
    border-radius: 999px;
    border: 2px solid var(--primary);
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    font-size: 14px;
  }

  .search-suggestions {
    display: none;
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    width: 100%;
    background: white;
    border-radius: 10px;
    border: 2px solid var(--primary);
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
    z-index: 100000;
  }

  .suggestion {
    padding: 10px;
    cursor: pointer;
    display: flex;
    gap: 10px;
    align-items: center;
    border-bottom: 1px solid #eee;
  }

  .suggestion:hover { background:#eef2ff; }

  .dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid black;
  }

  .phone-btn {
    background: var(--primary);
    color: white;
    border: 2px solid black;
    padding: 12px 16px;
    border-radius: 28px;
    font-weight: 600;
    cursor: pointer;
  }

  /* PHONE PANEL */
  .phone-panel {
    position: fixed;
    top: 0; right: 0;
    width: var(--panel-w);
    height: 100vh;
    background: #fff2f2;
    border-left: 3px solid black;
    padding: 18px;
    transform: translateX(100%);
    transition: transform .3s ease;
    z-index: 100001;
  }
  .phone-panel.open { transform: translateX(0); }

  /* LEGEND FIX ‚Äî push near bottom on all screens */
  .legend {
    position: fixed;
    left: 20px;
    bottom: 15px;
    background: white;
    padding: 10px 14px;
    border-radius: 8px;
    border: 2px solid black;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    z-index: 99999;
    font-size: 12px;
  }

  @media (max-width: 480px) {
    .legend {
      left: 12px;
      bottom: 12px; /* LOWER for small phones */
      padding: 8px 12px;
    }
  }
</style>
</head>
<body>

<div class="blue-banner"></div>

<header>
  Bedford Support Map <span class="byline">by CHECKPOINT</span>
</header>

<div class="controls-row">
  <div class="controls-inner">
    <div class="search-box">
      <input id="searchInput" class="search-input" placeholder="Search locations..." />
      <div id="suggestions" class="search-suggestions"></div>
    </div>

    <button class="phone-btn" id="phoneBtn">üìû Phone Numbers</button>
  </div>
</div>

<div id="map"></div>

<!-- LEGEND -->
<div class="legend">
  <b>Index</b><br><br>
  <i style="color:#d62828;">‚óè</i> Help Centres<br>
  <i style="color:#1d4ed8;">‚óè</i> Mental Health & Wellbeing<br>
  <i style="color:#138a36;">‚óè</i> Education & Youth<br>
  <i style="color:#7e22ce;">‚óè</i> Diverse Centres<br>
  <i style="color:#0e7490;">‚óè</i> Outdoor Wellbeing<br>
  <i style="color:#f97316;">‚óè</i> Local Services<br>
</div>

<!-- PHONE PANEL -->
<div id="phonePanel" class="phone-panel">
  <span id="panelClose" style="float:right; cursor:pointer;">‚úñ</span>
  <h3>Useful Phone Numbers</h3>
  <ul>
    <li>Citizens Advice: <b>01234 867944</b></li>
    <li>Bedford Foodbank: <b>01234 268569</b></li>
    <li>BRASS: <b>01234 211381</b></li>
    <li>Bedford Hospital: <b>01234 355122</b></li>
  </ul>
</div>

<script>
/* PHONE PANEL BEHAVIOUR */
const phoneBtn = document.getElementById("phoneBtn");
const phonePanel = document.getElementById("phonePanel");
const panelClose = document.getElementById("panelClose");

phoneBtn.onclick = () => phonePanel.classList.toggle("open");
panelClose.onclick = () => phonePanel.classList.remove("open");

/* MAP */
const map = L.map('map').setView([52.136, -0.47], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

/* MARKERS + SEARCH EXAMPLE (you can replace with your data) */
const locations = [
  { name: "Citizens Advice Bedford", coords: [52.1369, -0.4667], color: "#d62828" },
  { name: "Bedford Wellbeing Centre", coords: [52.1345, -0.4801], color: "#1d4ed8" },
  { name: "Youth Hub Bedford", coords: [52.1420, -0.4725], color: "#138a36" }
];

locations.forEach(loc => {
  L.circleMarker(loc.coords, {
    radius: 10,
    color: loc.color,
    fillColor: loc.color,
    fillOpacity: 0.9
  }).addTo(map).bindPopup(loc.name);
});

/* SEARCH */
const input = document.getElementById("searchInput");
const suggestionBox = document.getElementById("suggestions");

input.addEventListener("input", () => {
  const term = input.value.toLowerCase().trim();
  if (!term) { suggestionBox.style.display = "none"; return; }

  const match = locations.filter(l => l.name.toLowerCase().includes(term));

  suggestionBox.innerHTML = match.map(m =>
    `<div class="suggestion" data-name="${m.name}">
       <span class="dot" style="background:${m.color}"></span>
       ${m.name}
     </div>`
  ).join("");

  suggestionBox.style.display = "block";
});

document.addEventListener("click", (e) => {
  if (!suggestionBox.contains(e.target) && e.target !== input)
    suggestionBox.style.display = "none";
});

suggestionBox.addEventListener("click", e => {
  const row = e.target.closest(".suggestion");
  if (!row) return;

  const found = locations.find(l => l.name === row.dataset.name);
  if (found) {
    map.setView(found.coords, 16);
  }
  suggestionBox.style.display = "none";
});
</script>

</body>
</html>
